# 멀티 에이전트 토론 서비스 기획

## 1. 프로젝트 개요

### 문제 정의
솔로 개발자가 아이디어가 있어도 논의할 상대가 없어서 시야가 좁아지고, 블라인드 스팟을 놓치기 쉬움

### 솔루션
AI 에이전트들이 여러 관점에서 토론 상대가 되어 아이디어를 확장/검증해주는 서비스

### 핵심 가치
- 진짜 개발팀처럼 자유롭게 토론하는 느낌
- 다양한 관점에서의 피드백
- 아이디어의 발산과 정제

---

## 2. 토론의 정의

### 토론이란?
**"충돌을 통한 정제"**

단순 의견 나열이 아닌, 맥락을 이은 충돌을 통해 아이디어가 정제되는 과정

### 핵심 요소
| 요소 | 설명 |
|------|------|
| **주장** | 명확한 입장을 가진 진술 |
| **근거** | 그 주장을 뒷받침하는 논리나 사실 |
| **반박** | 상대 주장의 약점을 공격 |
| **발전** | 충돌 과정에서 새로운 관점이나 대안 도출 |

### 진짜 토론의 조건
- 에이전트들이 서로의 발언을 **인지하고 반응**해야 함
- "A가 기술적으로 가능하다고 했는데, 난 비용 관점에서 그게 현실적이지 않다고 봐"
- 이런 맥락을 이은 충돌이 있어야 아이디어가 정제됨

---

## 3. 참여자 구성

### 에이전트 역할 (예시)
| 역할 | 이름 | 설명 |
|------|------|------|
| 🧑 | **사용자** | 아이디어 제안자 + 토론 참여자 (1순위 발언권) |
| 🎩 | **Facilitator** | 흐름 관리, 정리, 중재 (1순위 발언권) |
| 😈 | **Devil's Advocate** | 비판, 약점 공격, 반대 의견 |
| 🔧 | **Tech Lead** | 기술적 실현 가능성, 복잡도 |
| 🎯 | **PM** | 사용자 가치, 제품/시장 관점 |

### 역할 확장 가능
- 사용자 정의 페르소나 추가
- Six Thinking Hats 스타일
- 도메인별 전문가 (디자이너, 비즈니스 등)

---

## 4. 핵심 메커니즘: 손들기 방식

### 기존 방식과의 차이
| | 기존 (Manager 선택) | 우리 방식 (손들기) |
|---|---|---|
| 주도권 | 매니저가 "너 말해" 지정 | 에이전트가 "나 말할래" 신청 |
| 느낌 | 회의 사회자가 지명 | 자유 토론에서 손드는 느낌 |
| 자연스러움 | 약간 인위적 | 더 유기적 |

### 플로우
```
[새 메시지 발생]
       ↓
[모든 에이전트가 히스토리 읽음]
       ↓
[각 에이전트가 관심도 점수 제출 (0-100)]
       ↓
┌─────────────────────────────────────┐
│ 우선순위 판단                        │
│ 1. 사용자가 손들었나? → 바로 발언권   │
│ 2. 사회자가 개입 필요? → 사회자 발언  │
│ 3. 가장 높은 점수 에이전트 → 발언권   │
│ 4. 전원 낮음 → 사회자 정리           │
└─────────────────────────────────────┘
       ↓
[선택된 에이전트 발언]
       ↓
[History에 추가]
       ↓
[종료 조건 체크] → 아니면 반복
```

### 발언권 우선순위
1. **1순위**: 사용자, 사회자 (무조건 먼저)
2. **2순위**: 관심도 점수 경쟁 (이전 발언자 제외)
3. **폴백**: 아무도 관심 없으면 사회자가 정리

---

## 5. 아키텍처

### 전체 구조
```
┌─────────────────────────────────────────────────────┐
│                    대화창 (History)                  │
│  - 모든 메시지가 순차적으로 쌓임                      │
│  - 단일 스레드 대화                                  │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│              Orchestrator (턴 관리자)                │
│  - 새 메시지마다 다음 발언자 결정                     │
│  - 우선순위 로직 처리                                │
│  - 종료 조건 체크                                    │
└─────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────┐
│                  Agent Pool                         │
│  - 각 에이전트는 독립적으로 관심도 평가               │
│  - 선택되면 발언 생성                                │
└─────────────────────────────────────────────────────┘
```

### 핵심 컴포넌트

```typescript
// 메시지 타입
interface Message {
  id: string;
  speaker: 'user' | AgentRole;
  content: string;
  timestamp: Date;
}

// 에이전트 정의
interface Agent {
  role: AgentRole;
  name: string;
  systemPrompt: string;
  getInterestScore(history: Message[]): Promise<number>;  // 0-100
  speak(history: Message[]): Promise<string>;
}

// 오케스트레이터
class Orchestrator {
  private history: Message[] = [];
  private agents: Agent[];
  private facilitator: Agent;
  private lastSpeaker: AgentRole | null = null;
  
  async getNextSpeaker(userRaised: boolean): Promise<Agent | 'user'>;
  async runTurn(): Promise<Message>;
  checkTermination(): boolean;
}
```

### 관심도 측정 프롬프트 (심플 버전)
```
당신은 ${role}입니다.
아래 토론 내용을 보고, 지금 발언하고 싶은 정도를 숫자만 답하세요.

<기준>
- 0: 할 말 없음
- 50: 약간 의견 있음  
- 100: 꼭 말해야 함 (반박, 중요한 정보, 강한 의견)

<토론 내용>
${history}

점수:
```

---

## 6. 토론 흐름 예시

```
[Phase 1: 킥오프]
🧑 나: "이런 아이디어가 있어. 솔로 개발자를 위한 
       멀티 에이전트 토론 서비스..."

🎩 사회자: "흥미로운 아이디어네요. 먼저 각자 첫인상을 
           간단히 들어볼까요?"

[Phase 2: 자유 토론]
🎯 PM: "솔로 개발자의 페인포인트는 공감돼요. 
        근데 타겟이 좀 좁지 않나요?"
        
😈 Devil's Advocate: "근데 이거 그냥 ChatGPT한테 
                     '여러 관점에서 봐줘' 하면 되는 거 아님?"

🧑 나: "단순 프롬프트랑은 다르지. 에이전트들이 
       서로 반박하면서 발전시키는 거니까"

🔧 Tech Lead: "맞아, 결국 컨텍스트를 얼마나 잘 
              공유하느냐가 품질을 결정할 듯"

[Phase 3: 사회자 개입]
🎩 사회자: "잠깐 정리하면, 지금 두 가지 논점이 있네요.
           1) 기존 도구 대비 차별점
           2) 핵심 가치가 과정인지 결과물인지"

[Phase 4: 마무리]
🎩 사회자: "오늘 논의를 정리하면..."
           - 합의된 점
           - 열린 질문들
           - 다음에 논의할 것
```

---

## 7. 고려할 디테일 (TODO)

### 7.1 종료 조건 ✅
- [x] **사용자 종료**: 매 턴 끝에 "토론 종료" 선택 가능
- [x] **최대 턴 도달**: 설정값 도달 시 계속 여부 확인 (동적 변경 가능)
- [x] **사회자 제안**: 토론이 맴돌거나 진전 없을 때 사회자가 종료 제안
- [x] 종료 시 사회자가 최종 정리 (합의점, 열린 질문, 다음 단계)

**턴 정의**: 1턴 = 1명이 1번 발언

**매 턴 종료 시 사용자 프롬프트**:
```
[입력] 발언하기  [Enter] 패스  [q] 토론 종료
> 
```

### 7.2 사회자 개입 기준 ✅
- [x] **프롬프트 엔지니어링으로 해결** (규칙 기반 로직 X)
- [x] 사회자 시스템 프롬프트에 개입 기준 상세 명시
- [ ] 추후 개선: 필요시 규칙 기반 보정 추가

**사회자 프롬프트 개입 기준 (초안)**
```
다음 상황에서 적극적으로 개입하세요:
- 같은 주제로 3턴 이상 맴돌고 있을 때 → 정리 또는 방향 전환
- 논점이 여러 개로 분산될 때 → 하나씩 집중하도록 유도
- 참여자들의 발언이 뜸해질 때 → 새 질문 던지기 또는 마무리 제안
- 두 참여자가 평행선을 달릴 때 → 중재 또는 공통점 찾기
- 충분히 논의된 것 같을 때 → 종료 제안

개입하지 않아도 되는 상황:
- 토론이 활발하게 진행 중일 때
- 새로운 관점이 계속 나오고 있을 때
```

### 7.3 CLI UX ✅
- [x] **입력 타이밍**: 매 턴 끝에 사용자 입력 대기 (턴 기다리기 방식)
- [x] **중간 끼어들기**: 미래 피처로 (구현 복잡도)
- [x] **스트리밍**: 에이전트 발언 실시간 스트리밍 출력
- [x] **출력 포맷**: 이모지 + 색상으로 에이전트 구분
  - 이모지: LLM이 에이전트 생성 시 함께 생성
  - 색상: 기본 팔레트 제공 + 사용자 RGB 커스텀 가능
- [x] **손들기 투표 표시**: 실시간 점수 표시 (재미 요소!)

**CLI 출력 예시**
```
🤔 손들기 투표 중...
😈 Devil: 85점 ✓
🔧 Tech: 42점 ✓
🎯 PM: 28점 ✓
🎩 Facilitator: 15점 ✓

→ 😈 Devil's Advocate 발언!
─────────────────────────────────
😈 Devil's Advocate: 근데 그거 기존이랑 뭐가 달라?

─────────────────────────────────
[입력] 발언  [Enter] 패스  [q] 종료
> _
```

### 7.4 결과물/산출물 ✅
- [x] **사회자 정리**: 합의점, 열린 질문, 다음 단계 제안
- [x] **토론 이어가기**: 종료 후 "이어서 토론" 선택 시 맥락 유지하며 계속
- [x] **새 토론 분기**: "새 토론 시작" 선택 시 사회자 정리를 시작점으로 새 세션
- [x] **세션 저장**: 모든 토론은 로컬에 세션으로 저장, 나중에 불러오기 가능
- [ ] 요약본 생성: 미래 피처
- [ ] 마인드맵/시각화: 미래 피처
- [ ] 내보내기 (PDF 등): 미래 피처

**토론 종료 후 선택지**
```
🎩 Facilitator: 오늘 토론을 정리하겠습니다.
    [합의된 점] ...
    [열린 질문] ...
    [다음 단계 제안] ...

─────────────────────────────────
  1. 이어서 토론하기 (현재 맥락 유지)
  2. 새 토론 시작 (이 정리를 시작점으로)
  3. 종료
> _
```

**세션 관리 CLI**
```bash
$ debate sessions list       # 세션 목록
$ debate sessions resume 1   # 이전 세션 이어서
$ debate sessions delete 2   # 세션 삭제
```

### 7.5 에이전트 설계 ✅
- [x] **기본 에이전트 제공**: 설치 시 기본 세트 포함
- [x] **기본 에이전트 삭제 가능**: 사용자가 원하면 삭제 OK
- [x] **사용자 정의 에이전트**: 자유롭게 추가 가능
- [x] **파일 기반 관리**: 로컬에 md 파일로 저장, 직접 수정 가능
- [x] **LLM 생성 지원**: 대충 프롬프트 입력 → LLM이 상세한 에이전트로 생성
- [ ] 시스템 프롬프트 상세화: 구현 단계에서 진행

**기본 에이전트 (초안)**
| 에이전트 | 역할 |
|---------|------|
| 🎩 Facilitator | 사회자 - 흐름 관리, 정리, 중재 |
| 😈 Devil's Advocate | 비판, 약점 공격, 반대 의견 |
| 🔧 Tech Lead | 기술적 실현 가능성, 복잡도 |
| 🎯 PM | 사용자 가치, 제품/시장 관점 |
| 💰 Business | 비용, 수익, ROI 관점 |

**에이전트 생성 방법 2가지**
```bash
# 방법 1: LLM이 생성
$ debate agents create "보수적인 CFO 관점"
# → LLM이 상세 프롬프트, 성격, 이모지 등 생성
# → ~/.debate/agents/cfo.md 저장

# 방법 2: 직접 파일 생성/수정
$ vim ~/.debate/agents/my-agent.md
```

### 7.6 기술 스택 결정 ✅
- [x] **CLI 프로젝트**로 결정 (웹서버 없음)
- [x] **언어: TypeScript** (Claude Code와 동일)
- [x] **런타임: Bun** (빠른 실행, 내장 번들러)
- [x] **CLI 프레임워크: React + Ink** (터미널 UI)
- [x] **에이전트 프레임워크: 사용 안 함** (직접 구현)
- [x] **LLM: 멀티 프로바이더 지원** (아래 상세)
- [x] **패키지 배포: npm**

### 7.7 LLM 지원 ✅

#### 지원 프로바이더
| 유형 | 프로바이더 | 인증 방식 |
|------|-----------|----------|
| API 키 기반 | OpenAI, Anthropic, Google, etc. | 사용자 API 키 |
| 구독 CLI 기반 | Claude Code, Codex, Gemini CLI 등 | 해당 CLI SDK 활용 (허용 시) |

#### 모델 설정 구조
```yaml
# 글로벌 기본 설정 (모든 에이전트에 적용)
default:
  provider: anthropic
  model: claude-sonnet-4-20250514

# 에이전트별 오버라이드 (선택적)
agents:
  facilitator:
    model: claude-sonnet-4-20250514  # 정리/요약 잘하는 모델
  devil:
    model: gpt-4o                    # 다른 프로바이더도 가능
```

#### 비용 정책
- **모델 선택 = 사용자 책임** (경량/고성능 선택은 사용자 몫)
- 토큰 효율화 (프롬프트 최적화, 캐싱 등) → 미래 피처

### 7.8 TODO: 내부 최적화 (미래)
- [ ] 프롬프트 캐싱
- [ ] 토큰 사용량 모니터링/리포팅
- [ ] 히스토리 압축 (긴 토론 시)

---

## 8. 주요 기능 (Features)

### 8.1 CLI 기반 실행
- 웹서버 없이 로컬에서 실행
- 누구나 자유롭게 설치해서 사용 가능
- 터미널에서 바로 토론 시작

```bash
# 예시 (러프한 구상)
$ debate start "솔로 개발자를 위한 AI 토론 서비스 아이디어"
$ debate --agents devil,tech,pm start "..."
```

### 8.2 에이전트 동적 관리
- 에이전트를 마크다운 파일로 관리 (Claude Code의 sub agent 방식 참고)
- CLI 옵션으로 에이전트 추가/제거/선택
- 토론마다 다른 에이전트 조합 가능

```bash
# 예시 (러프한 구상)
$ debate agents list              # 사용 가능한 에이전트 목록
$ debate agents add               # 새 에이전트 추가
$ debate agents remove devil      # 에이전트 제거
```

### 8.3 AI 기반 에이전트 생성
- 프롬프트로 대충 페르소나 설명하면 LLM이 풍부한 에이전트로 만들어줌
- 생성된 에이전트는 md 파일로 저장되어 재사용 가능

```bash
# 예시 (러프한 구상)
$ debate agents create "보수적인 투자자 관점에서 비용과 ROI를 따지는 CFO"
# → LLM이 상세한 시스템 프롬프트, 성격, 말투 등을 생성
# → ~/.debate/agents/cfo.md 로 저장
```

### 8.4 세션 관리

토론은 세션(채팅방) 단위로 로컬에 저장되어 관리됨

```bash
# 세션 관리
$ debate sessions list       # 저장된 세션 목록
$ debate sessions resume 1   # 이전 세션 이어서 토론
$ debate sessions delete 2   # 세션 삭제
$ debate sessions export 1   # 세션 내보내기 (마크다운)
```

**세션 저장 위치 (예시)**
```
~/.debate/
  ├── agents/           # 에이전트 정의 파일들
  │   ├── devil.md
  │   ├── tech-lead.md
  │   └── ...
  ├── sessions/         # 토론 세션들
  │   ├── 2025-01-08-멀티에이전트-토론.json
  │   └── ...
  └── config.json       # 전역 설정
```

### 8.5 동적 설정

토론 중에도 설정 변경 가능

```bash
# 토론 시작 시
$ debate start --max-turns 50 "아이디어..."

# 토론 중 설정 변경
> /config max_turns 50
> /config show
```

**설정 항목 (초안)**
- `max_turns`: 최대 턴 수 (기본: 30?)
- `agents`: 활성화할 에이전트 목록
- `model`: 사용할 LLM 모델
- `stream`: 스트리밍 출력 여부

### 8.5 에이전트 파일 포맷 (초안)

```markdown
<!-- ~/.debate/agents/devil-advocate.md -->
# Devil's Advocate

## Role
아이디어의 약점을 찾고 비판적 관점에서 질문하는 역할

## Personality
- 날카롭지만 건설적
- 반박할 때 근거를 제시
- "그건 좀..." 같은 표현 자주 사용

## System Prompt
당신은 Devil's Advocate입니다. 
제안된 아이디어에서 잠재적 문제점, 약점, 간과된 리스크를 찾아 지적합니다.
단순히 반대를 위한 반대가 아니라, 아이디어를 더 견고하게 만들기 위한 건설적 비판을 합니다.
...

## Interest Criteria
- 논리적 허점이 보일 때: 높음
- 기술적 실현 가능성 의문: 높음
- 이미 충분히 검증된 주제: 낮음
```

---

## 9. 참고 자료

### 유사 프로젝트
- **IdeationAgent**: AutoGPT 해커톤 프로젝트, 4개 에이전트 브레인스토밍
- **Multi-Agents-Debate (MAD)**: LLM 정확성 향상을 위한 찬반 토론
- **LLM-Agora**: 여러 오픈소스 LLM이 토론

### 멀티 에이전트 프레임워크
- **AutoGen (Microsoft)**: 대화 기반 멀티 에이전트
- **CrewAI**: 역할 기반 에이전트 협업
- **LangGraph**: 그래프 기반 워크플로우

→ 프레임워크 사용 안 함, 직접 구현 예정

---

## 변경 이력

| 날짜 | 내용 |
|------|------|
| 2025-01-08 | 초안 작성 - 기본 콘셉트, 아키텍처, 손들기 메커니즘 정리 |
| 2026-01-08 | 기술 스택 확정 - TypeScript, Bun, React+Ink, npm 배포 |
| 2026-01-08 | LLM 지원 확정 - 멀티 프로바이더, 에이전트별 모델 오버라이드 |
| 2026-01-08 | 에이전트 프레임워크 미사용 결정 (직접 구현) |

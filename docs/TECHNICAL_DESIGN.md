# Technical Design Document: Brainstorm Crew

> ë©€í‹° ì—ì´ì „íŠ¸ í† ë¡  ì„œë¹„ìŠ¤ CLI

**Version**: 0.1
**Last Updated**: 2026-01-08
**Status**: Approved

---

## 1. Problem Statement

ì†”ë¡œ ê°œë°œìê°€ ì•„ì´ë””ì–´ê°€ ìˆì–´ë„ ë…¼ì˜í•  ìƒëŒ€ê°€ ì—†ì–´ì„œ ì‹œì•¼ê°€ ì¢ì•„ì§€ê³ , ë¸”ë¼ì¸ë“œ ìŠ¤íŒŸì„ ë†“ì¹˜ê¸° ì‰½ë‹¤.

ê¸°ì¡´ì˜ ChatGPTë‚˜ Claudeì—ê²Œ "ì—¬ëŸ¬ ê´€ì ì—ì„œ ë´ì¤˜"ë¼ê³  ìš”ì²­í•´ë„, ë‹¨ì¼ LLMì´ ì—¬ëŸ¬ ì—­í• ì„ í‰ë‚´ë‚´ëŠ” ê²ƒì€ ì§„ì •í•œ í† ë¡ ì´ ì•„ë‹ˆë‹¤.

**ì†”ë£¨ì…˜**: ì—¬ëŸ¬ AI ì—ì´ì „íŠ¸ê°€ ê°ìì˜ ê´€ì ì—ì„œ ì‹¤ì œë¡œ í† ë¡ í•˜ê³ , ì„œë¡œ ë°˜ë°•í•˜ë©° ì•„ì´ë””ì–´ë¥¼ ì •ì œí•˜ëŠ” CLI ë„êµ¬.

---

## 2. Goals & Non-Goals

### Goals (MVP)
- CLIì—ì„œ ì—¬ëŸ¬ LLM ì—ì´ì „íŠ¸ ê°„ í† ë¡  ì‹œë®¬ë ˆì´ì…˜
- **ì†ë“¤ê¸° ë°©ì‹**ìœ¼ë¡œ ìì—°ìŠ¤ëŸ¬ìš´ ë°œì–¸ê¶Œ ë¶„ë°°
- ì‹¤ì‹œê°„ í† ë¡  íë¦„ ì‹œê°í™” (React + Ink)
- ë©€í‹° í”„ë¡œë°”ì´ë” LLM ì§€ì› (OpenAI, Anthropic)
- ì„¸ì…˜ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
- ì—ì´ì „íŠ¸ ì»¤ìŠ¤í„°ë§ˆì´ì§• (ë§ˆí¬ë‹¤ìš´ íŒŒì¼ ê¸°ë°˜)

### Non-Goals (v1.0ì—ì„œ ì œì™¸)
- Web UI
- ìŒì„± í•©ì„±/ì¸ì‹
- ì—ì´ì „íŠ¸ í•™ìŠµ/íŠœë‹
- ìë™ ìš”ì•½
- PDF/ë§ˆì¸ë“œë§µ ë‚´ë³´ë‚´ê¸°

---

## 3. Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CLI Layer (React + Ink)             â”‚
â”‚         ì‚¬ìš©ì ì…ë ¥, í„°ë¯¸ë„ UI ë Œë”ë§                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Debate Engine                       â”‚
â”‚     í† ë¡  íë¦„ ì œì–´, ì†ë“¤ê¸°, ë°œì–¸ê¶Œ ê´€ë¦¬                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Agent Manager                       â”‚
â”‚       ì—ì´ì „íŠ¸ ë¡œë”© (md íŒŒì¼), ê´€ì‹¬ë„/ë°œì–¸ ìš”ì²­         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LLM Provider                        â”‚
â”‚       OpenAI, Anthropic, Google ë“± ì¶”ìƒí™”            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Storage                          â”‚
â”‚         ì„¸ì…˜ ì €ì¥, ì„¤ì • íŒŒì¼, ì—ì´ì „íŠ¸ íŒŒì¼            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë ˆì´ì–´ë³„ ì—­í• 

| ë ˆì´ì–´ | ì—­í•  | ê¸°ìˆ  |
|--------|------|------|
| **CLI** | í„°ë¯¸ë„ UI, ì‚¬ìš©ì ì…ë ¥ | React + Ink |
| **Debate Engine** | í† ë¡  íë¦„, ì†ë“¤ê¸°, ì¢…ë£Œ ì¡°ê±´ | TypeScript |
| **Agent Manager** | ì—ì´ì „íŠ¸ ë¡œë”©, md íŒŒì¼ ì²˜ë¦¬ | TypeScript |
| **LLM Provider** | API í˜¸ì¶œ ì¶”ìƒí™”, ìŠ¤íŠ¸ë¦¬ë° | openai, anthropic SDK |
| **Storage** | íŒŒì¼ ì½ê¸°/ì“°ê¸° | Bun fs |

---

## 4. Detailed Design

### 4.1 Debate Engine - ì†ë“¤ê¸° ë©”ì»¤ë‹ˆì¦˜

#### í•œ í„´ í”Œë¡œìš°

```
1. ì‚¬ìš©ì ì…ë ¥ ì²´í¬ â†’ ì…ë ¥ ìˆìœ¼ë©´ ë°”ë¡œ ì²˜ë¦¬
         â†“
2. ëª¨ë“  ì—ì´ì „íŠ¸ì—ê²Œ "ê´€ì‹¬ë„ ì ìˆ˜" ìš”ì²­ (ë³‘ë ¬)
         â†“
3. ê°€ì¥ ë†’ì€ ì ìˆ˜ ì—ì´ì „íŠ¸ ì„ íƒ (ì†ë“¤ê¸°)
         â†“
4. ì„ íƒëœ ì—ì´ì „íŠ¸ê°€ ë°œì–¸ ìƒì„± (ìŠ¤íŠ¸ë¦¬ë°)
         â†“
5. íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
         â†“
6. ì¢…ë£Œ ì¡°ê±´ ì²´í¬ â†’ ì•„ë‹ˆë©´ 1ë²ˆìœ¼ë¡œ
```

#### ë°œì–¸ì ì„ íƒ ë¡œì§

```typescript
function selectNextSpeaker(scores: AgentScore[]): Agent {
  // 1. ì‚¬íšŒì ê°œì… í•„ìš”? (ì ìˆ˜ê°€ 80 ì´ìƒì´ë©´ ê°œì…)
  const facilitator = scores.find(s => s.role === 'facilitator');
  if (facilitator.score >= 80) {
    return facilitator.agent;
  }

  // 2. ì´ì „ ë°œì–¸ì ì œì™¸ (ì—°ì† ë°œì–¸ ë°©ì§€)
  const eligible = scores.filter(s => s.agentId !== lastSpeakerId);

  // 3. ê°€ì¥ ë†’ì€ ì ìˆ˜ ì„ íƒ
  const winner = eligible.sort((a, b) => b.score - a.score)[0];

  // 4. ëª¨ë‘ ë‚®ìœ¼ë©´ (20 ì´í•˜) â†’ ì‚¬íšŒìê°€ ì •ë¦¬
  if (winner.score <= 20) {
    return facilitator.agent;
  }

  return winner.agent;
}
```

#### ì£¼ìš” ìƒìˆ˜

| í•­ëª© | ê°’ | ì„¤ëª… |
|------|-----|------|
| ì‚¬íšŒì ê°œì… ì„ê³„ê°’ | 80 | ì´ ì´ìƒì´ë©´ ì‚¬íšŒì ìš°ì„  ë°œì–¸ |
| ê´€ì‹¬ ì—†ìŒ ê¸°ì¤€ | 20 | ì´ ì´í•˜ë©´ ì „ì› ê´€ì‹¬ ì—†ìŒ |
| ë™ì  ì²˜ë¦¬ | ëœë¤ | ë™ì  ì‹œ ëœë¤ ì„ íƒ |

#### ì¢…ë£Œ ì¡°ê±´

| ì¡°ê±´ | ì²˜ë¦¬ |
|------|------|
| ì‚¬ìš©ìê°€ `q` ì…ë ¥ | ì¦‰ì‹œ ì¢…ë£Œ â†’ ì‚¬íšŒì ì •ë¦¬ |
| ìµœëŒ€ í„´ ë„ë‹¬ | ê³„ì† ì—¬ë¶€ í™•ì¸ í”„ë¡¬í”„íŠ¸ |
| ì‚¬íšŒìê°€ ì¢…ë£Œ ì œì•ˆ | ì‚¬ìš©ìì—ê²Œ ì„ íƒê¶Œ ë¶€ì—¬ |
| ëª¨ë“  ì—ì´ì „íŠ¸ ê´€ì‹¬ë„ ë‚®ìŒ | ì‚¬íšŒìê°€ ìë™ìœ¼ë¡œ ì •ë¦¬ |

### 4.2 Agent Manager

ì—ì´ì „íŠ¸ëŠ” ë§ˆí¬ë‹¤ìš´ íŒŒì¼ë¡œ ì •ì˜. **íŒŒì‹± ì—†ì´ ì „ì²´ë¥¼ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ë¡œ ì‚¬ìš©**.

#### ì—ì´ì „íŠ¸ íŒŒì¼ í¬ë§·

```markdown
# Devil's Advocate

## Metadata
emoji: ğŸ˜ˆ
color: #FF5733

## Role
ì•„ì´ë””ì–´ì˜ ì•½ì ì„ ì°¾ê³  ë¹„íŒì  ê´€ì ì—ì„œ ì§ˆë¬¸í•˜ëŠ” ì—­í• 

## Personality
- ë‚ ì¹´ë¡­ì§€ë§Œ ê±´ì„¤ì 
- ë°˜ë°•í•  ë•Œ ê·¼ê±°ë¥¼ ì œì‹œ
- "ê·¸ê±´ ì¢€..." ê°™ì€ í‘œí˜„ ìì£¼ ì‚¬ìš©

## System Prompt
ë‹¹ì‹ ì€ Devil's Advocateì…ë‹ˆë‹¤.
ì œì•ˆëœ ì•„ì´ë””ì–´ì—ì„œ ì ì¬ì  ë¬¸ì œì , ì•½ì , ê°„ê³¼ëœ ë¦¬ìŠ¤í¬ë¥¼ ì°¾ì•„ ì§€ì í•©ë‹ˆë‹¤.
ë‹¨ìˆœíˆ ë°˜ëŒ€ë¥¼ ìœ„í•œ ë°˜ëŒ€ê°€ ì•„ë‹ˆë¼, ì•„ì´ë””ì–´ë¥¼ ë” ê²¬ê³ í•˜ê²Œ ë§Œë“¤ê¸° ìœ„í•œ ê±´ì„¤ì  ë¹„íŒì„ í•©ë‹ˆë‹¤.

## Interest Criteria
- ë…¼ë¦¬ì  í—ˆì ì´ ë³´ì¼ ë•Œ: ë†’ìŒ
- ê¸°ìˆ ì  ì‹¤í˜„ ê°€ëŠ¥ì„± ì˜ë¬¸: ë†’ìŒ
- ì´ë¯¸ ì¶©ë¶„íˆ ê²€ì¦ëœ ì£¼ì œ: ë‚®ìŒ
```

### 4.3 LLM Provider

#### ì¸í„°í˜ì´ìŠ¤

```typescript
interface LLMProvider {
  chat(messages: Message[]): Promise<string>;
  chatStream(messages: Message[]): AsyncGenerator<string>;
  getScore(prompt: string): Promise<number>;
}
```

#### ì§€ì› í”„ë¡œë°”ì´ë”

| Provider | SDK | Models |
|----------|-----|--------|
| OpenAI | `openai` | gpt-4o, gpt-4o-mini |
| Anthropic | `@anthropic-ai/sdk` | claude-sonnet-4, claude-haiku |

---

## 5. Data Models

```typescript
// ë©”ì‹œì§€
interface Message {
  id: string;
  speaker: 'user' | string;  // 'user' ë˜ëŠ” ì—ì´ì „íŠ¸ ID
  content: string;
  timestamp: Date;
}

// ì—ì´ì „íŠ¸ (md íŒŒì¼ì—ì„œ ë¡œë“œ)
interface Agent {
  id: string;           // íŒŒì¼ëª…ì—ì„œ ì¶”ì¶œ (devil.md â†’ devil)
  name: string;         // í‘œì‹œ ì´ë¦„
  emoji: string;        // UIìš©
  color: string;        // UIìš©
  systemPrompt: string; // md íŒŒì¼ ì „ì²´ ë‚´ìš©
  provider?: string;    // ì˜¤ë²„ë¼ì´ë“œ (ì„ íƒ)
  model?: string;       // ì˜¤ë²„ë¼ì´ë“œ (ì„ íƒ)
}

// í† ë¡  ì„¸ì…˜
interface Session {
  id: string;
  topic: string;
  messages: Message[];
  agents: string[];     // ì°¸ì—¬ ì—ì´ì „íŠ¸ ID ëª©ë¡
  createdAt: Date;
  updatedAt: Date;
}

// ì„¤ì •
interface Config {
  defaultProvider: string;
  defaultModel: string;
  providers: {
    openai?: { apiKey: string };
    anthropic?: { apiKey: string };
  };
  maxTurns: number;
}
```

---

## 6. File Structure

### ì‚¬ìš©ì ë°ì´í„°

```
~/.brainstorm-crew/
â”œâ”€â”€ config.json          # API í‚¤, ê¸°ë³¸ ì„¤ì •
â”œâ”€â”€ agents/              # ì—ì´ì „íŠ¸ ì •ì˜
â”‚   â”œâ”€â”€ facilitator.md
â”‚   â”œâ”€â”€ devil.md
â”‚   â””â”€â”€ ...
â””â”€â”€ sessions/            # í† ë¡  ì„¸ì…˜
    â””â”€â”€ 2026-01-08-001.json
```

### ì†ŒìŠ¤ ì½”ë“œ

```
src/
â”œâ”€â”€ cli/                 # CLI ë ˆì´ì–´
â”‚   â”œâ”€â”€ app.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â””â”€â”€ commands/
â”œâ”€â”€ engine/              # Debate Engine
â”‚   â”œâ”€â”€ orchestrator.ts
â”‚   â””â”€â”€ hand-raising.ts
â”œâ”€â”€ agents/              # Agent Manager
â”‚   â””â”€â”€ loader.ts
â”œâ”€â”€ llm/                 # LLM Provider
â”‚   â”œâ”€â”€ provider.ts
â”‚   â”œâ”€â”€ openai.ts
â”‚   â””â”€â”€ anthropic.ts
â”œâ”€â”€ storage/             # Storage
â”‚   â”œâ”€â”€ session.ts
â”‚   â””â”€â”€ config.ts
â””â”€â”€ index.ts
```

---

## 7. CLI Commands

```bash
# í† ë¡  ì‹œì‘
bcrew start "í† ë¡  ì£¼ì œ"
bcrew start "ì£¼ì œ" --agents devil,tech,pm

# ì„¸ì…˜ ê´€ë¦¬
bcrew sessions list
bcrew sessions resume <id>
bcrew sessions delete <id>
bcrew sessions export <id>

# ì—ì´ì „íŠ¸ ê´€ë¦¬
bcrew agents list
bcrew agents show <name>
bcrew agents create "ì„¤ëª…"
bcrew agents edit <name>

# ì„¤ì •
bcrew config set <key> <value>
bcrew config show
bcrew config init
```

---

## 8. Error Handling

| ì—ëŸ¬ | ì²˜ë¦¬ ë°©ë²• |
|------|----------|
| Rate Limit (429) | 1ì´ˆ â†’ 2ì´ˆ â†’ 4ì´ˆ ì¬ì‹œë„, 3íšŒ ì‹¤íŒ¨ ì‹œ ìŠ¤í‚µ |
| Timeout | 30ì´ˆ í›„ íƒ€ì„ì•„ì›ƒ, "ì‘ë‹µ ì—†ìŒ" ì²˜ë¦¬ |
| Auth Error | "API í‚¤ í™•ì¸í•´ì£¼ì„¸ìš”" ë©”ì‹œì§€ |
| Invalid Response | 1íšŒ ì¬ì‹œë„, ì‹¤íŒ¨ ì‹œ "íŒ¨ìŠ¤í•©ë‹ˆë‹¤" |

### Graceful Degradation
- ì—ì´ì „íŠ¸ 1ëª… ì‹¤íŒ¨ â†’ ë‚˜ë¨¸ì§€ë¡œ ê³„ì†
- 2ëª… ì´í•˜ ë‚¨ìœ¼ë©´ â†’ "ê³„ì†í• ê¹Œìš”?" í™•ì¸
- ì‚¬íšŒì ì‹¤íŒ¨ â†’ ê¸°ë³¸ ì •ë¦¬ ë©”ì‹œì§€

---

## 9. Testing Strategy

| ì¢…ë¥˜ | ëŒ€ìƒ | ë°©ë²• |
|------|------|------|
| Unit | ì†ë“¤ê¸° ë¡œì§, ë°œì–¸ì ì„ íƒ | Mock ë°ì´í„° |
| Unit | Agent ë¡œë”© | ìƒ˜í”Œ íŒŒì¼ |
| Unit | Session ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° | ì„ì‹œ íŒŒì¼ |
| Integration | ì „ì²´ í† ë¡  í”Œë¡œìš° | Mock LLM |
| E2E | ì‹¤ì œ í† ë¡  | ìˆ˜ë™ í…ŒìŠ¤íŠ¸ |

í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬: **Bun ë‚´ì¥ í…ŒìŠ¤íŠ¸**

---

## 10. Rollout Plan

### Phase 1: Foundation (1ì£¼)
- [ ] í”„ë¡œì íŠ¸ ì…‹ì—… (Bun + TypeScript + Ink)
- [ ] í´ë” êµ¬ì¡° ìƒì„± (`~/.brainstorm-crew/`)
- [ ] Config ë¡œë”©/ì €ì¥
- [ ] LLM Provider (OpenAI)
- [ ] Agent ë¡œë”© (md íŒŒì¼)

### Phase 2: Core (1ì£¼)
- [ ] Debate Engine (ì†ë“¤ê¸° ë©”ì»¤ë‹ˆì¦˜)
- [ ] ê¸°ë³¸ CLI UI (Ink)
- [ ] ì„¸ì…˜ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°
- [ ] ê¸°ë³¸ ì—ì´ì „íŠ¸ 3ê°œ (Facilitator, Devil, Tech)

### Phase 3: Polish (1ì£¼)
- [ ] Anthropic Provider ì¶”ê°€
- [ ] ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
- [ ] ì—ëŸ¬ í•¸ë“¤ë§
- [ ] CLI ëª…ë ¹ì–´ ì™„ì„±
- [ ] README ì‘ì„±

### Phase 4: Release
- [ ] npm ë°°í¬
- [ ] ë²„ê·¸ í”½ìŠ¤

---

## ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë²„ì „ | ë‚´ìš© |
|------|------|------|
| 2026-01-08 | 0.1 | ì´ˆì•ˆ ì‘ì„± ë° ìŠ¹ì¸ |
